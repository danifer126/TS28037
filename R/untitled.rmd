# -*- coding: utf-8 -*-
"""Untitled

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1tm0vx7eeYs-JlUCX0aez_U02kMquChEL

# REGRESIÓN PONDERADA

**DATOS**
"""

rm(list = ls())

## Asignar datos de medición

 x <- c(1.0, 2.0, 3.0, 4.0, 5.0, 6.0)


## Asignar valores de y
 y <- c(3.3, 5.6, 7.1, 9.3, 10.7, 12.1)

## Asignar incertidumbres asociadas a los valores de y
 uy <- c(0.5, 0.5, 0.5, 1, 1, 1)

"""Obtener estimaciones de los parámetros de la función de calibración en línea recta y las incertidumbres y covarianzas estándar asociadas. Resolver el problema de mínimos cuadrados ponderados para obtener los parámetros de la recta de mejor ajuste.

$$w_i = \frac{1}{u(y_i)}, \quad i = 1, \ldots, m,\quad \quad F_2 = \sum_{i=1}^{m} w_i^2.$$
"""

m <- length(x)
# Paso 1.
w <- 1/uy
F2 <- sum(w*w)

"""$$
 g_0 = \frac{1}{F_2} \sum_{i=1}^{m} w_i^2 x_i \quad \quad  h_0 = \frac{1}{F_2} \sum_{i=1}^{m} w_i^2 y_i; \\
$$

"""

# Paso 2.
g0 <- sum(w*w*x) / F2
h0 <- sum(w*w*y) / F2

"""$$ g_i = w_i(x_i - g_0) \quad \quad h_i = w_i(y_i - h_0), \quad i = 1, \ldots, m  $$"""

# Paso 3.
g <- w * (x - g0)
h <- w * (y - h0)

$$  G_2 = \sum_{i=1}^{m} g_i^2 $$

# Paso 4.
G2 <- sum(g * g)

"""$$ b = \frac{1}{G_2} \sum_{i=1}^{m} g_i h_i  \quad \quad a = h_0 - bg_0 $$"""

# Paso 5.
b <- sum(g * h) / G2
a <- h0 - b * g0

"""$$ u^2(a) = \frac{1}{F_2} + \frac{g_0^2}{G_2}, \quad u^2(b) = \frac{1}{G_2}  \quad \text{y} \quad  u(a,b)=\text{cov}(a, b) = -\frac{g_0}{G_2} $$



"""

# Paso 6.
u2a <- 1/F2 + g0^2/G2
u2b <- 1/G2
uab <- -g0/G2

"""Nota 1: los pasos 1 a 5 son equivalentes a realizar:

1 - $ w_i = \frac{1}{u(y_i)}, \quad i = 1, \ldots, m, \quad x_0 = \frac{{\sum_{i=1}^{m} w_i^2 x_i}}{{\sum_{i=1}^{m} w_i^2}}\quad \quad y_0 = \frac{{\sum_{i=1}^{m} w_i^2 y_i}}{{\sum_{i=1}^{m} w_i^2}}$

2 -  $\tilde{x}_i = x_i - x_0 \quad \quad \tilde{y}_i  = y_i - y_0, \quad i = 1, \ldots, m $

3 - $ b = \frac{{\sum_{i=1}^{m} w_i^2 \tilde{x}_i  \tilde{y}_i }}{{\sum_{i=1}^{m} w_i^2 \tilde{x}_i ^2}} \quad \quad a = y_0 - bx_0$


Nota 2: Los pasos 1 a 5 determinan la solución de la ecuación $\quad w_i a + w_i x_i b = w_i y_i, \quad i = 1, \ldots, m$

La valiación de modelo.


Si $m>2$ se puede realizar la validación con los residuales del modelo.

$$r=w_i(y_i-a-bx_i)$$
"""

# Paso 7.
r <- w * (y-a-b*x)

# Paso 8.
chi_sq_obs <- sum(r * r)
nu <- (m - 2)

# Paso 9.
chi_sq <- calc_chi_sq_95_percent_quantile(nu)